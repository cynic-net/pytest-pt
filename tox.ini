[tox]
requires = tox>4

skip_missing_interpreters = false
env_list =
    #   pytest_pt doesn't work with pytest 5.x on Python â‰¥3.10
    py{3.7,3.8,3.9}-pytest5
    #   pytest 7 compatibility not yet implemented
    py{3.7,3.8,3.9,3.10,3.11,3.12}-pytest7
    #   XXX tox can't seem to find python3.6, though it's there.
    #py3.6-pytest{5,7}

[testenv]
deps =
    pytest4: pytest==4.*
    pytest5: pytest==5.*
    pytest6: pytest==6.*
    pytest7: pytest==7.*
commands =
    #   pytest will fail if there are no tests to run. Thus, using -k
    #   separately on both the one test from *.pt and the one test from
    #   *_test.py will ensure that both tests are being collected and run.
    pytest -qq pylib/ -k pt_test {posargs}
    pytest -qq pylib/ -k regular_test {posargs}

#   Specifying explicit paths to Pythons here doesn't seem to work; tox
#   complains about "env name py3.8-pytest5 conflicting with base python...",
#   regardless of the ignore_base_python_conflict setting. (More details at
#   <https://stackoverflow.com/q/77823499/107294>.) So for the moment, we
#   hack this by just having the Test script add all of the pythonz Pythons'
#   bin/ dirs to the path, and tox seems to find the right ones.
#   <https://stackoverflow.com/a/67308364/107294> might provide some
#   useful hints as to how to do this better.
#
#ignore_base_python_conflict = false
#base_python =
#    py3.8: /home/cjs/.pythonz/pythons/CPython-3.8.18/bin/python3.8
#    py3.9: /home/cjs/.pythonz/pythons/CPython-3.9.18/bin/python3
